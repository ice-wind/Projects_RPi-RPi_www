<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
	<title>Get_forecast_data</title>
		<script src="../Graph/js/jquery-1.11.3.js"></script> 
		<script type="text/javascript">
		//var Alle_forecast_data = new all_forecast_data(dt,dt_txt,clouds_all,grnd_level,humidity,pressure,sea_level,temp,temp_max,temp_min,rain,weather_description,weather_icon,weather_main,wind_deg,wind_speed);

		
		function all_forecast_data (dt,dt_txt,clouds_all,grnd_level,humidity,pressure,sea_level,temp,temp_max,temp_min,rain,weather_description,weather_icon,weather_main,wind_deg,wind_speed)
		{
			this.dt = dt;
			this.dt_txt = dt_txt;
			this.clouds_all = clouds_all;
			this.grnd_level = grnd_level;
			this.humidity = humidity;
			this.pressure = pressure;
			this.sea_level = sea_level;
			this.temp = temp;
			this.temp_max = temp_max;
			this.temp_min = temp_min;
			this.rain = rain;
			this.weather_description = weather_description;
			this.weather_icon = weather_icon;
			this.weather_main = weather_main;
			this.wind_deg = wind_deg;
			this.wind_speed = wind_speed;
				this.getinfo = function(){return this.dt;};
		}
			
		function push_data_2DB(forecast_object){
			var cnt = forecast_object.dt.length;
			
			for (var i=0;i<cnt;i++){
				var JSONstring = JSON.stringify([forecast_object.dt[i],forecast_object.dt_txt[i],forecast_object.clouds_all[i],forecast_object.grnd_level[i],forecast_object.humidity[i],forecast_object.pressure[i],forecast_object.sea_level[i],forecast_object.temp[i],forecast_object.temp_max[i],forecast_object.temp_min[i],forecast_object.rain[i],forecast_object.weather_description[i],forecast_object.weather_icon[i],forecast_object.weather_main[i],forecast_object.wind_deg[i],forecast_object.wind_speed[i]]);
				console.log(JSONstring);
				$.ajax({
					url: "ajax/send_data.php",
					type: "POST",
					data: {data : JSONstring},
					cache:false,
					
					success: function(){
						alert("success");
					}
				});
			}
		}
			//"http://api.openweathermap.org/data/2.5/forecast?id=524901"
			function get_forecast(callback){
			var url = "http://api.openweathermap.org/data/2.5/forecast?id=524901";
			// var url = "http://api.openweathermap.org/data/2.5/forecast/city?id=3060972&APPID=42b4a1a0b8ea3a847fedd3c183ab4f2b&cnt=14";
			$.getJSON(url,function(result){	
				//console.log("get");
					callback(result);

			});
		}
			
			function put_to_arrayObject(data){
					var dt=[],dt_txt=[],clouds_all=[],grnd_level=[],humidity=[],pressure=[],sea_level=[],temp=[],temp_max=[],temp_min=[],rain=[],weather_description=[],weather_icon=[],weather_main=[],wind_deg=[],wind_speed=[];
					var cnt = data.list.length;
					var rain = [];
					
					for(i=0;i<cnt;i++){
						dt[i] = (data.list[i].dt);
						dt_txt[i] = data.list[i].dt_txt;
						clouds_all[i] = data.list[i].clouds.all;
						grnd_level[i] = data.list[i].main.grnd_level;
						humidity[i] = data.list[i].main.humidity;
						pressure[i] = data.list[i].main.pressure;
						sea_level[i] = data.list[i].main.sea_level;
						temp[i] = data.list[i].main.temp;
						temp_max[i] = data.list[i].main.temp_max;
						temp_min[i] = data.list[i].main.temp_min;
						weather_description[i] = data.list[i].weather[0].description;
						weather_icon[i] = data.list[i].weather[0].icon;
						weather_main[i] = data.list[i].weather[0].main;
						wind_deg[i] = data.list[i].wind.deg;
						wind_speed[i] = data.list[i].wind.speed;
						
						try{
							console.log(rain[i] = data.list[i].rain["3h"]);
							}
							catch(exception){
								console.log("0");
								rain[i] = 0;
							}
						
					}
				return put_to_object(dt,dt_txt,clouds_all,grnd_level,humidity,pressure,sea_level,temp,temp_max,temp_min,rain,weather_description,weather_icon,weather_main,wind_deg,wind_speed);	
				//forecast_data = put_to_object(dt,dt_txt,clouds_all,grnd_level,humidity,pressure,sea_level,temp,temp_max,temp_min,rain,weather_description,weather_icon,weather_main,wind_deg,wind_speed);
				
			}
			
			function put_to_object(dt,dt_txt,clouds_all,grnd_level,humidity,pressure,sea_level,temp,temp_max,temp_min,rain,weather_description,weather_icon,weather_main,wind_deg,wind_speed){
					all_forecast_data.dt=(dt);
					all_forecast_data.dt_txt=(dt_txt);
					all_forecast_data.clouds_all=(clouds_all);
					all_forecast_data.grnd_level=(grnd_level);
					all_forecast_data.humidity=(humidity);
					all_forecast_data.pressure=(pressure);
					all_forecast_data.sea_level=(sea_level);
					all_forecast_data.temp=(temp);
					all_forecast_data.temp_max=(temp_max);
					all_forecast_data.temp_min=(temp_min);
					all_forecast_data.weather_description=(weather_description);
					all_forecast_data.weather_icon=(weather_icon);
					all_forecast_data.weather_main=(weather_main);
					all_forecast_data.wind_deg=(wind_deg);
					all_forecast_data.wind_speed=(wind_speed);
					all_forecast_data.rain=(rain);
					
					return all_forecast_data;
					
				
			}
		$(document).ready(function(){
			setInterval(function(){
				get_forecast(function(result_JSON){
					var forecast_object = put_to_arrayObject(result_JSON);
					console.log(forecast_object);
					
					push_data_2DB(forecast_object);
					alert("s");
				});
			},1080); // every 3h
		});
			
			
		</script>
</head>
<body>
<div>h</div>
</body>
</html>
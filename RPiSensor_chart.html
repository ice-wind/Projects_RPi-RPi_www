<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
	<title>Get_forecast_data</title>
	<script src="../Graph/js/jquery-1.11.3.js"></script> 
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/highcharts-more.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>
	<script src="http://code.highcharts.com/modules/solid-gauge.js"></script>
	<script type="text/javascript">
	var chart;
		function loadJSON(callback){
			$.getJSON("get_tempInOut_hum.php",function(result){	
					callback(result);
			});
		}
		function addJSONpoint(callback){
			$.getJSON("add_point_tempInOut_hum.php",function(result){	
					callback(result);
			});
		}
		
		Highcharts.setOptions({
			global: {
				timezoneOffset: 6 * 60
			},
			xAxis: {
					name: 'time',
					type: 'datetime',
					ordinal: false,
					crosshair:false,
					gridLineWidth:1
			},
					
			tooltip:{
					useHTML: true,
					formatter: function(){
						var picture_url = '';
						if(this.series.name == "Temp In"){
							picture_url = '<img src="img/Temp.png" title="" alt="" border="1" height="25" width="22" align="center">';
						}else
						if(this.series.name == "Hum"){
							picture_url = '<img src="img/Hum.png" title="" alt="" border="1" height="25" width="22" align="center">';
						}else
						if(this.series.name = "Temp Out"){
							picture_url = '<img src="img/Press.png" title="" alt="" border="1" height="25" width="22" align="center">';
							}
						else
							{
							picture_url = ' ';
							}
							return picture_url+'<b>' + this.series.name + '</b><br/>' + 
							Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>'+
							Highcharts.numberFormat(this.y, 2);
					}					
			},
					
			plotOptions:{
					areaspline:{
							fillOpacity:0.1
					},
					spline:{
							states:{
								hover:{
									lineWidth:4
								}
							}
						}
			}
		});
		
		$(document).ready(function(){
			loadJSON(function(data){
				var chart_options = {
					chart: {
						renderTo: '1graph_temperature',
						type: 'spline',
						zoomType:'x'
					},
					title: {
						text: 'RPi'
					},
					yAxis: [{//first axis
						gridLineWidth:1,
						minorTickInterval: 'auto',
						title: {
							text: 'Temp In',
							style: {
								color: 'green'
								}
						},
						labels:{
							format: '{value} °C',
							style:{
								color:'green'
							}
						},
						opposite: false,
						plotBands:[{
							
						}]
						
					},{//Sec yAxis
						gridLineWidth:1,
						TickInterval: 'auto',
						title:{
							text: 'Hum',
							style: {
								color: '#00A3CC'
							}
						},
						labels:{
							format: '{value} %',
							style:{
								color: '#00A3CC'
								}
						},
						opposite: true,
					},{//Third
						gridLineWidth: 1,
						TickInterval: 'auto',
						title:{
								text: 'Temp Out',
								style:{
									color: '#6B4C9A'
									}
								},
								labels:{
									format: '{value} °C',
									style:{
										color: '#6B4C9A'
										}	
								},
						opposite: true
					}],
					series: [{
						name: 'Temp In',
						type: 'spline',
						yAxis: 0,
						data: (function(){
								var temp_in_data = [];
								$.each(data,function(i,field){							
									var i ={};
									i={x:field.time,y:field.Temp_in,z:field.Humidity};
									temp_in_data.push(i);
								});
								console.log(temp_in_data);
							return temp_in_data;
						})(),
						dataLabels:{
								enabled:true,
								useHTML:true,
								formatter:function(){
									// return '<span>'+this.y+'</span><br/>'+this.series+'<img src="'+this.key+'" />';
									return this.point.z;
								}
							},
						color: '#3E9651',
						negativeColor: '#0088FF',
						tooltip:{
							valueSuffix: '°C',
						}
					},{
						name:'Hum',
						type: 'areaspline',
						yAxis: 1,
						data: (function(){
							var hum_data = [];
							$.each(data,function(i,field){
								var i = [];
								i={x:field.time,y:field.Humidity}
								hum_data.push(i);
								});
								console.log(hum_data);
							return hum_data;
							})(),
						tooltip:{
							valueSuffix: '%'
						},
						dashStyle: 'shortdashdot',
						marker:{
							enabled: false,
							symbol: 'circle',
							radius: 2,
							states:{
								hover:{
									enabled:true
								}
							}
						}
					},{
						name: 'Temp Out',
						type: 'spline',
						yAxis:2,
						data: (function(){
							var temp_out_data = [];
							$.each(data,function(i,field){
								var i = [];
								i={x:field.time,y:field.Temp_out}
								temp_out_data.push(i);
							});
							return temp_out_data;
						})(),
						color:'#6B4C9A',
						tooltip:{
							valueSuffix:'Pa'
						},
						negativeColor: '#0088FF',
					}]
				}
//---------------------------------2Chart Press ----------------------------------------------				
				var chart_options_pressure = {
					chart: {
						renderTo: '2graph_pressure',
						type: 'spline',
						zoomType:'x'
					},
					title: {
						text: 'Pressure'
					},
					yAxis: [{
						gridLineWidth:1,
						minorTickInterval: 'auto',
						title: {
							text: 'Pressure',
							style: {
								color: '#6C3738'
								}
						},
						labels:{
							format: '{value} Pa',
							style:{
								color:'#6C3738'
							}
						},
						opposite: false,
					},{
						gridLineWidth:1,
						minorTickInterval: 'auto',
						title: {
							text: 'Altitude',
							style: {
								color: '#5C83A3'
								}
						},
						labels:{
							format: '{value} Pa',
							style:{
								color:'#5C83A3'
							}
						},
						opposite: true,
					}],
					series: [{
						name: 'Pressure',
						type: 'spline',
						yAxis: 0,
						data: (function(){
								var pressure_data = [];
								$.each(data,function(i,field){							
									var i ={};
									i={x:field.time,y:field.Pressure};
									pressure_data.push(i);
								});
								console.log(pressure_data);
							return pressure_data;
						})(),
						dataLabels:{
								enabled:true,
								useHTML:true
							},
						color: '#6C3738',
						tooltip:{
							valueSuffix: 'Pa',
						},
						dashStyle: 'longdash'
					},
					{
						name: 'Altitude',
						type: 'spline',
						yAxis: 1,
						data: (function(){
								var altitude_data = [];
								$.each(data,function(i,field){							
									var i ={};
									i={x:field.time,y:field.Altitude};
									altitude_data.push(i);
								});
								console.log(altitude_data);
							return altitude_data;
						})(),
						color: '#5C83A3',
						tooltip:{
							valueSuffix: 'Pa',
						},
						dashStyle: 'longdashdot'
					}]
				}
//---------------------------------3Chart Sea level ----------------------------------------------
				var chart_options_sealevel = {
					chart: {
						renderTo: '3graph_sealevel',
						type: 'spline',
						zoomType:'x'
					},
					title: {
						text: 'Sea level'
					},
					yAxis: {
						gridLineWidth:1,
						minorTickInterval: 'auto',
						title: {
							text: 'Sea level',
							style: {
								color: '#EA8D11'
								}
						},
						labels:{
							format: '{value} Pa',
							style:{
								color:'#EA8D11'
							}
						},
						opposite: false,
					},
					series: [{
						name: 'Sea_level',
						type: 'spline',
						yAxis: 0,
						data: (function(){
								var sealevel_data = [];
								$.each(data,function(i,field){							
									var i ={};
									i={x:field.time,y:field.Sea_level};
									sealevel_data.push(i);
								});
								console.log(sealevel_data);
							return sealevel_data;
						})(),
						dataLabels:{
								enabled:true,
								useHTML:true
							},
						color: '#EA8D11',
						tooltip:{
							valueSuffix: 'Pa',
						}
					}]
				}
//----------------------------END of graph def-----------------------------------
//----------------------------Gauge default options--------------------------------------
				var defaultGaugeOptions = {

							chart: {
                type: 'solidgauge',
                    margin: [0, 0, 0, 0],
                    backgroundColor: 'transparent'
                },
                title: null,
                yAxis: {
                    min: 0,
                    max: 30,
                    minColor: '#009CE8',
                    maxColor: '#009CE8',
                    lineWidth: 0,
                    tickWidth: 0,
                    minorTickLength: 0,
                    minTickInterval: 500,
                    labels: {
                        enabled: false
                    }
                },
                pane: {
                    size: '100%',
                    center: ['50%', '60%'],
                    startAngle: -130,
                    endAngle: 130,
                    background: {
                    borderWidth: 20,
                    backgroundColor: '#6B4C9A',
                    shape: 'arc',
                    borderColor: '#DBDBDB',
                        outerRadius: '90%',
                        innerRadius: '90%'
                    }
                },
                
                plotOptions: {
                    solidgauge: {
                        borderColor: '#009CE8',
                        borderWidth: 20,
                        radius: 90,
                        innerRadius: '90%',
                        dataLabels: {
                            borderWidth: 0,
                            useHTML: false
                        }
                    }
                }
				}
//---------------------------gauge1 options----------------------------------------
					var gaugeOptions_tempIn = {
							chart: {
								renderTo: '1gauge'
							},
							yAxis: {
								min: 0,
								max: 200,
								minColor: '#99D6AD',
								maxColor: '#005C1F',
								title: {
									text: 'T (home)'
								}
							},
							plotOptions:{
								solidgauge:{
									borderColor:'green'
								}
							},
							tooltip:{
								enabled:false
							},
							credits: {
								enabled: false
							},
							series: [{
								name: 'Temp in',
								data: 
										(function(){		
												var temp_in_data = [data[data.length-1].Temp_in];
											return temp_in_data;
										})(),
								dataLabels: {
									useHTML: true,
									format: '<img src="img/Hum.png" width="50px" align="center"><div style="Width: 50px;text-align:center"><span style="font-size:30px;color:#009933">{y}</span></div>'
								}
							}]
					}
					var gaugeOptions_tempOut = {
							chart: {
								renderTo: '2gauge'
							},
							yAxis: {
								min: 0,
								max: 200,
								minColor: '#99D6AD',
								maxColor: '#005C1F',
								title: {
									text: 'T (out)'
								}
							},
							plotOptions:{
								solidgauge:{
									borderColor:'purple'
								}
							},
							tooltip:{
								enabled:false
							},
							credits: {
								enabled: false
							},
							series: [{
								name: 'Temp out',
								data: 
										(function(){		
												var temp_out_data = [data[data.length-1].Temp_out];
											return temp_out_data;
										})(),
								dataLabels: {
									format: '<div style="Width: 50px;text-align:center"><span style="font-size:30px;color:purple">{y}</span></div>'
								}
							}]
					}
					var gaugeOptions_humidity = {
							chart: {
								renderTo: '3gauge'
							},
							yAxis: {
								min: 0,
								max: 200,
								title: {
									text: 'Humidity'
								}
							},
							tooltip:{
								enabled:false
							},
							credits: {
								enabled: false
							},
							series: [{
								name: 'Humidity',
								data: 
										(function(){		
												var humidity_data = [data[data.length-1].Humidity];
											return humidity_data;
										})(),
								dataLabels: {
								
									format: '<div style="Width: 50px;text-align:center"><span style="font-size:30px;color:#009ce8">{y}</span></div>'
								}
							}]
					}
					var gaugeOptions_pressure = {
							chart: {
								renderTo: '4gauge'
							},
							yAxis: {
								min: 0,
								max: 5000,
								title: {
									text: 'Pressure'
								}
							},
							plotOptions:{
								solidgauge:{
									borderColor:'orange'
								}
							},
							tooltip:{
								enabled:false
							},
							credits: {
								enabled: false
							},
							series: [{
								name: 'Pressure',
								data: 
										(function(){		
												var pressure_data = [data[data.length-1].Pressure];
											return pressure_data;
										})(),
								dataLabels: {
									format: '<div style="Width: 50px;text-align:center"><span style="font-size:30px;color:orange">{y}</span></div>'
								}
							}]
					}
//--------------------------end of gauge options------------------------------------

				gaugeOptions_tempIn = jQuery.extend(true,[],defaultGaugeOptions,gaugeOptions_tempIn);
				var gauge1 = new Highcharts.Chart(gaugeOptions_tempIn);
				gaugeOptions_tempOut = jQuery.extend(true,[],defaultGaugeOptions,gaugeOptions_tempOut);
				var gauge2 = new Highcharts.Chart(gaugeOptions_tempOut);
				gaugeOptions_humidity = jQuery.extend(true,[],defaultGaugeOptions,gaugeOptions_humidity);
				var gauge3 = new Highcharts.Chart(gaugeOptions_humidity);
				gaugeOptions_pressure = jQuery.extend(true,[],defaultGaugeOptions,gaugeOptions_pressure);
				var gauge4 = new Highcharts.Chart(gaugeOptions_pressure);
				
//-------------------------------round corner in gauge-----------------------------------------				
				var svg;
					svg = document.getElementsByTagName('svg');
					if (svg.length > 0) {
						$.each(svg,function(i,field){
							var path = field.getElementsByTagName('path')
								if (path.length > 1) {
									console.log(path);
									// First path is gauge background
									path[0].setAttributeNS(null, 'stroke-linejoin', 'round');
									// Second path is gauge value
									path[2].setAttributeNS(null, 'stroke-linejoin', 'round');
							}
						})
						
					}
//-------------------------------end round corner----------------------------------------
				
				//var chart_temp_hum = new Highcharts.Chart(gaugeOptions_tempIn);
				var chart_temp_hum = new Highcharts.Chart(chart_options);
				var chart_pressure = new Highcharts.Chart(chart_options_pressure);
				var chart_sealevel = new Highcharts.Chart(chart_options_sealevel);
				console.log('end');
			
			});
			
			/*
				setInterval(function(){
					console.log("Retrieving data from server ");
					var url = "add_point_tempInOut_hum.php";
					
					$.getJSON(url,function(data){
						var series = $('#container').highcharts().series[0];
						var shift_points = false;
						if (series.data.length>=240){
							shift_points = true;
							}
						//console.log(series);
						series.addPoint(data[0],false,shift_points);
						 $('#container').highcharts().redraw();
					});
				},18000000);  // repeat every 30 min
				*/
		});
	</script>
</head>
<body>
	<div id="1gauge" style="width: 200px; height: 200pxs;float: left"></div>
	<div id="2gauge" style="width: 200px; height: 200pxs;float: left"></div>
	<div id="3gauge" style="width: 200px; height: 200pxs;float: left"></div>
	<div id="4gauge" style="width: 200px; height: 200pxs;"></div>
	<div id='1graph_temperature'>h</div>
	<div id='2graph_pressure'></div>
	<div id='3graph_sealevel'></div>
	
	
</body>
</html>
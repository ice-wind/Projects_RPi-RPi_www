<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
	<title>Get_forecast_data</title>
	<script src="../Graph/js/jquery-1.11.3.js"></script> 
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>
	<script type="text/javascript">
	var chart;
		function loadJSON(callback){
			$.getJSON("get_DBdata.php",function(result){	
					callback(result);

			});
		}
		function addJSONpoint(callback){
			$.getJSON("add_point.php",function(result){	
					callback(result);

			});
		}
		
		Highcharts.setOptions({
			global: {
				timezoneOffset: -2 * 60
			}
		});
		
		$(document).ready(function(){
			loadJSON(function(data){
				var options = {
					chart: {
						renderTo: 'container',
						type: 'spline',
						zoomType:'x'
					},
					global: {
						 timezoneOffset: 6 * 60
					},
					title: {
						text: 'Fruit Consumption'
					},
					xAxis: {
						type: 'datetime',
						ordinal: false,
						crosshair:true,
						gridLineWidth:1
					},
					yAxis: [{
						gridLineWidth:1,
						minorTickInterval: 'auto',
						title: {
							text: 'Temp',
							style: {
								color: '#d1240a'
								}
						},
						labels:{
							format: '{value} °C',
							style:{
								color:'#d1240a'
							}
						},
						opposite: false,
						plotBands:[{
							
						}]
						
					},{//Sec yAxis
						gridLineWidth:1,
						TickInterval: 'auto',
						title:{
							text: 'Hum',
							style: {
								color: '#00AEC2'
							}
						},
						labels:{
							format: '{value} %',
							style:{
								color: '#00AEC2'
								}
						},
						opposite: true,
						},{//Third
						gridLineWidth: 1,
						TickInterval: 'auto',
						title:{
								text: 'Press',
								style:{
									color: '#c69b01'
									}
								},
								labels:{
									format: '{value} Pa',
									style:{
										color: '#c69b01'
										}	
								},
						opposite: true

					}],
					
					tooltip:{
						useHTML: true,
						formatter: function(){
							var picture_url = '';
							if(this.series.name == "Temp"){
								picture_url = '<img src="img/Temp.png" title="" alt="" border="1" height="25" width="22" align="center">';
							}else
							if(this.series.name == "Hum"){
								picture_url = '<img src="img/Hum.png" title="" alt="" border="1" height="25" width="22" align="center">';
							}else
							if(this.series.name = "Press"){
								picture_url = '<img src="img/Press.png" title="" alt="" border="1" height="25" width="22" align="center">';
							}
								return picture_url+'<b>' + this.series.name + '</b><br/>' + 
								Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>'+
								Highcharts.numberFormat(this.y, 2);
						}					
					},
					
					plotOptions:{
						areaspline:{
							fillOpacity:0.1
						},
						spline:{
							states:{
								hover:{
									lineWidth:4
								}
							}
						}
					},
					series: [{
						
						name: 'Temp',
						type: 'spline',
						yAxis: 0,
						data: (function(){
								var temp_data = [];
								$.each(data,function(i,field){
									var i =[];
									i.push(field.time);
									i.push(field.Temp);
									i.push(field.Hum);
									temp_data.push(i);
								});
							return temp_data;
						})(),
						dataLabels:{
								enabled:true,
								useHTML:true,
								formatter:function(){
									// return '<span>'+this.y+'</span><br/>'+this.series+'<img src="'+this.key+'" />';
									return '<img src="http://highcharts.com/demo/gfx/sun.png"><img>&nbsp;';
								}
							},
						color: '#FF3D8B',
						negativeColor: '#CCFFFF',
						tooltip:{
							valueSuffix: '°C',
						}
					},{
						name:'Hum',
						type: 'areaspline',
						yAxis: 1,
						data: (function(){
							var hum_data = [];
							$.each(data,function(i,field){
								var i = [];
								i.push(field.time);
								i.push(field.Hum);
								hum_data.push(i);
								});
							return hum_data;
							})(),
						tooltip:{
							valueSuffix: '%'
						},
						dashStyle: 'shortdashdot',
						marker:{
							enabled: false,
							symbol: 'circle',
							radius: 2,
							states:{
								hover:{
									enabled:true
								}
							}
						}
					},{
						name: 'Press',
						type: 'spline',
						yAxis:2,
						data: (function(){
							var press_data = [];
							$.each(data,function(i,field){
								var i = [];
								i.push(field.time);
								i.push(field.Press);
								press_data.push(i);
							});
							console.log(press_data);
							return press_data;
						})(),
						color:'#FFFF8F',
						tooltip:{
							valueSuffix:'Pa'
						}
					}]
				}
				//console.log(data);
			chart = new Highcharts.Chart(options);
			//console.log(chart.series[0]);
			
			
			});
				/*
				setInterval(function(){
					console.log("Retrieving data from server ");
					var url = "add_point.php";
					
					$.getJSON(url,function(data){
						var series = $('#container').highcharts().series[0];
						var shift_points = false;
						if (series.data.length>=240){
							shift_points = true;
							}
						//console.log(series);
						series.addPoint(data[0],false,shift_points);
						 $('#container').highcharts().redraw();
					});
				},5000);
				*/
		});
	</script>
</head>
<body>
	<div id='container'>h</div>
	
</body>
</html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
	<title>Get_forecast_data</title>
	<link rel="stylesheet" type="text/css" href="css/5day.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/highcharts-more.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>
	<script src="http://code.highcharts.com/modules/solid-gauge.js"></script>
	<script type="text/javascript" src="js/5day.js"></script>
	<script type="text/javascript" src="js/search.js"></script>
	<script type="text/javascript">
	var chart;
	$(document).ready(function () {
		function loadScript(url, callback)
		{
			// Adding the script tag to the head as suggested before
			var head = document.getElementsByTagName('head')[0];
			var script = document.createElement('script');
			script.type = 'text/javascript';
			script.src = url;

			// Then bind the event to the callback function.
			// There are several events for cross browser compatibility.
			script.onreadystatechange = callback;
			script.onload = callback;

			// Fire the loading
			head.appendChild(script);
		}
		//----------------------------load data from JSON---------------------
		//Global variable:
		var Temperature=[],
			Humidity=[],
			Sea_level=[],
			Grnd_level=[],
			Clouds=[],
			Rain=[],
			Snow=[],
			Weather_description=[],
			Weather_icon=[],
			Icon_id=[],
			Weather_main=[],
			Pressure=[],
			Wind_speed=[],
			Wind_deg=[];
			
		function fillVariables(data){
			$.each(data,function(i,field){
					var Clouds_array=[];
					Temperature.push({x:field.time,y:field.Temperature});
					Humidity.push({x:field.time,y:field.Humidity});
					Sea_level.push({x:field.time,y:field.Sea_level});
					Grnd_level.push({x:field.time,y:field.Grnd_level});
					Clouds_array.push(field.time);
					Clouds_array.push(field.Clouds);
					Clouds_array.push(-field.Clouds);
					Clouds.push(Clouds_array);
					Rain.push({x:field.time,y:field.Rain});
					Snow.push({x:field.time,y:field.Snow});
					Weather_description.push({x:field.time,y:field.Weather_description});
					Weather_icon.push({x:field.time,y:field.Weather_icon});
					Icon_id.push({x:field.time,y:field.Icon_id});
					Weather_main.push({x:field.time,y:field.Weather_main});
					Pressure.push({x:field.time,y:field.Pressure});
					Wind_speed.push({x:field.time,y:field.Wind_speed});
					Wind_deg.push({x:field.time,y:0,wind_deg:field.Wind_deg});
				})
		}
		
		loadJSON(function(data){
			fillVariables(data);
			createCharts();
		});
		
		//---------------------------END load data---------------------------
//------------------------------------DEFINITION MAIN TEMERATURE-------------------------------
			main_options.series[0].data=Temperature;
			main_options.series[1].data=Humidity;
			main_options.series[2].data=Rain;
			main_options.series[3].data=Snow;
			main_options.series[4].data=Clouds;
			
//----------------------------------------DEFINITION CHART WIND--------------------------------		
			options_windSpeed.series[0].data=Wind_speed;
			options_windSpeed.series[1].data=Wind_deg;
			options_windSpeed.series[1].dataLabels.formatter=function(){
				var wind_deg=this.point.wind_deg;									
				return '<img src="img/wind_arrow.png" width="20px" height="20px" style= " float:left; transform: rotate('+wind_deg+'deg) scale(1);-ms-transform: rotate('+wind_deg+'deg) scale(1); -webkit-transform:rotate('+wind_deg+'deg) scale(1);" />';
			};
//----------------------------------------DEFINITION CHART PRESSURE--------------------------------			
			options_pressure.series[0].data=Pressure;
			options_pressure.series[1].data=Grnd_level;
//----------------------------------------DEFINITION CHART SEA LEVEL--------------------------------							
			options_sealevel.series[0].data=Sea_level;
//---------------------------------------GAUGE OPTIONS--------------------------------------------------

	gaugeOptions_Temperature.series=[{
						name: 'Temp in',
						data:[0],
						dataLabels: {
							useHTML: true,
							format: '<img src="img/Hum.png" width="50px" align="center"><div style="Width: 50px;text-align:center"><span style="font-size:30px;color:#009933">{y}</span></div>'
						}
					}]
	gaugeOptions_Sea_level.series= [{
						name: 'Temp out',
						data: [0],
						dataLabels: {
							format: '<div style="Width: 50px;text-align:center"><span style="font-size:30px;color:purple">{y}</span></div>'
						}
					}]		
	gaugeOptions_humidity.series= [{
						name: 'Humidity',
						data: [0],
						dataLabels: {
						
							format: '<div style="Width: 50px;text-align:center"><span style="font-size:30px;color:#009ce8">{y}</span></div>'
						}
					}]
	gaugeOptions_pressure.series= [{
						name: 'Pressure',
						data: [0],
						dataLabels: {
							format: '<div style="Width: 50px;text-align:center"><span style="font-size:30px;color:orange">{y}</span></div>'
						}
					}]
//---------------------------------------------------update-------------------------------------------------------			
			$(".change").click(function(){
				update_charts();
			});
					
			
	function update_charts(){
			var chart = $('#2gauge').highcharts(),
						point,
						newVal,
						
						
			point = chart.series[0].points[0];
			newVal = 3;
			
			point.update(newVal);
			console.log("New dataset:");
			console.log(newVal);
	}
	
	function getForecastData(city_id,city_name){
				if(isMenuChoice5Day()){
					var url = "php/getDBdata_5Day.php";
				}
				else{
					var url = "php/getDBdata_16Day.php";
				}
					$.ajax({
						type: 	"GET",
						url:	url,
						dataType: "json",
						data:	{city_id:city_id},
						success:function(response){
						
							
							
								
									$.each(response,function(i,value){
										fillVariables(value);
										console.log(Temperature);
										var container = $('#container').highcharts();
										container.series[0].setData(Temperature);
										container.series[1].setData(Humidity);
										container.series[2].setData(Rain);
										container.series[3].setData(Snow);
										container.series[4].setData(Clouds);
									
									});
							
							
						},
						error: function(jqXHR, exception) {
							console.log(jqXHR);
							if (jqXHR.status === 0) {
								alert('Not connect.\n Verify Network.');
							} else if (jqXHR.status == 404) {
								alert('Requested page not found. [404]');
							} else if (jqXHR.status == 500) {
								alert('Internal Server Error [500].');
							} else if (exception === 'parsererror') {
								alert('Requested JSON parse failed.');
							} else if (exception === 'timeout') {
								alert('Time out error.');
							} else if (exception === 'abort') {
								alert('Ajax request aborted.');
							} else {
								alert('Uncaught Error.\n' + jqXHR.responseText);
							}
						  
						},
						stop:function(){
							alert("Ajax exit with status: --Stop");
						}
					});
					return false;
			}
			
	});
	</script>

</head>
<body>
Start
	<button class="change">set neew data</button>
	
	<div class="base_class">
		<form autocomplete="on" id="search">
			<input class="search" type="search" size="30"  onkeyup="handle_key(event);" data-search="" autofocus placeholder="Search..." >
			<div id="livesearch"></div>
			<div class="result"></div>
		</form>
	</div>
	
	<div id='container'>h</div>
	<div id='graph_windSpeed'>h</div>
	<div id='2graph_pressure'>h</div>
	<div id='3graph_sealevel'>h</div>
	
	<div id='1gauge'></div>
	<div id='2gauge'></div>
	<div id='3gauge'></div>
	<div id='4gauge'></div>
</body>
</html>